<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nany Premia√ß√µes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #1a1a1a 0%, #2d1b69 50%, #000000 100%); color: #fff; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { width: 100%; max-width: 400px; background: rgba(0,0,0,0.8); border: 2px solid #8B5CF6; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(139,92,246,0.3); position: relative; }
        h1, h2, h3 { text-align: center; color: #8B5CF6; margin-bottom: 15px; }
        input, select, button, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #8B5CF6; border-radius: 8px; background: rgba(255,255,255,0.1); color: #fff; }
        button { background: linear-gradient(135deg, #8B5CF6, #A78BFA); cursor: pointer; font-weight: bold; }
        button:hover { transform: scale(1.03); }
        .panel { display: none; }
        .rifa-item { border: 1px solid #8B5CF6; padding: 10px; margin: 10px 0; border-radius: 8px; }
        .rifa-details { display: none; margin-top: 10px; }
        .rifa-details.active { display: block; }
        .hidden-opt { display: none; }
        .hidden-opt.active { display: block; }
        .error { color: #EF4444; text-align: center; }
        .success { color: #10B981; text-align: center; }
        .notification-btn { position: absolute; top: 10px; right: 10px; width: 40px; height: 40px; border-radius: 50%; background: #8B5CF6; border: none; cursor: pointer; font-size: 20px; }
        .notification-panel { display: none; position: absolute; top: 60px; right: 10px; width: 300px; max-height: 400px; overflow-y: auto; background: rgba(0,0,0,0.9); border: 2px solid #8B5CF6; border-radius: 10px; padding: 15px; z-index: 1000; }
        .notification-panel.active { display: block; }
        .contact { margin-top: 20px; font-size: 14px; color: #A78BFA; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Auth -->
        <div id="authSection">
            <h1>Nany Premia√ß√µes</h1>
            <form id="authForm">
                <select id="authType"><option value="register">Registrar</option><option value="login">Login</option></select>
                <input type="text" id="username" placeholder="Usu√°rio" required>
                <input type="password" id="password" placeholder="Senha" required>
                <button type="submit">Entrar</button>
            </form>
            <div id="message"></div>
        </div>

        <!-- User Panel -->
        <div id="userPanel" class="panel">
            <h2>Usu√°rio: <span id="userName"></span></h2>
            <p>Moedas: <span id="userCoins">0</span></p>
            <button class="notification-btn" onclick="toggleNotifications()">üîî</button>
            <div id="notificationPanel" class="notification-panel"></div>
            <h3>Participar Rifa</h3>
            <select id="rifaSelect" onchange="showRifaDetails()"></select>
            <div id="rifaDetails" class="rifa-details"></div>
            <h3>Suas Rifas</h3>
            <div id="userRifas"></div>
            <button onclick="logout()">Sair</button>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="panel">
            <h2>Admin</h2>
            <button class="notification-btn" onclick="toggleNotifications()">üîî</button>
            <div id="notificationPanelAdmin" class="notification-panel"></div>
            <h3>Enviar Notifica√ß√£o</h3>
            <form id="sendNotificationForm">
                <select id="notifyUserSelect"></select>
                <textarea id="notificationMessage" placeholder="Mensagem"></textarea>
                <button type="submit">Enviar</button>
            </form>
            <h3>Dar Moedas</h3>
            <form id="giveCoinsForm">
                <select id="userSelect"></select>
                <input type="number" id="coinAmount" placeholder="R$" min="1">
                <button type="submit">Dar</button>
            </form>
            <h3>Criar Rifa</h3>
            <form id="createRifaForm">
                <input type="text" id="rifaTitle" placeholder="T√≠tulo">
                <input type="date" id="rifaDate">
                <input type="number" id="rifaPrice" placeholder="Pre√ßo" step="0.01">
                <input type="number" id="totalNumbers" placeholder="N√∫meros">
                <button type="button" onclick="toggleHiddenOpt()">Op√ß√µes Avan√ßadas</button>
                <div id="hiddenOpt" class="hidden-opt">
                    <textarea id="chancesText" placeholder="user1:5:2,user2:3:1"></textarea>
                </div>
                <button type="submit">Criar</button>
            </form>
            <h3>Rifas</h3>
            <div id="adminRifas"></div>
            <button onclick="logout()">Sair</button>
        </div>
    </div>
    <div class="contact">PIX: +55 75 98868-8483</div>

    <script>
        let data = { users: {}, rifas: [], notifications: {} };
        let currentUser = null;

        // Carrega do localStorage
        function loadData() {
            const saved = localStorage.getItem('nany_data');
            if (saved) {
                data = JSON.parse(saved);
            } else {
                data = { users: { admin: { password: 'admin', coins: 0, rifasParticipadas: [] } }, rifas: [], notifications: {} };
            }
        }

        // Salva no localStorage
        function saveData() {
            localStorage.setItem('nany_data', JSON.stringify(data));
        }

        // Mostra mensagem
        function showMessage(msg, type) {
            const div = document.getElementById('message');
            div.innerHTML = `<div class="${type}">${msg}</div>`;
            setTimeout(() => div.innerHTML = '', 3000);
        }

        // Auth
        document.getElementById('authForm').onsubmit = (e) => {
            e.preventDefault();
            loadData();
            const type = document.getElementById('authType').value;
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;

            if (type === 'register') {
                if (data.users[u]) return showMessage('Usu√°rio existe!', 'error');
                data.users[u] = { password: p, coins: 0, rifasParticipadas: [] };
                showMessage('Registrado!', 'success');
            } else {
                if (!data.users[u] || data.users[u].password !== p) return showMessage('Senha errada!', 'error');
            }
            saveData();
            login(u);
        };

        function login(u) {
            currentUser = u;
            document.getElementById('userName').textContent = u;
            document.getElementById('userCoins').textContent = data.users[u].coins;
            document.getElementById('authSection').style.display = 'none';
            if (u === 'admin') {
                document.getElementById('adminPanel').style.display = 'block';
                loadAdmin();
            } else {
                document.getElementById('userPanel').style.display = 'block';
                loadUserData();
            }
            loadNotifications();
        }

        function logout() {
            currentUser = null;
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('userPanel').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
        }

        // Notifica√ß√µes
        function toggleNotifications() {
            const panel = currentUser === 'admin' ? 'notificationPanelAdmin' : 'notificationPanel';
            document.getElementById(panel).classList.toggle('active');
            loadNotifications();
        }

        function loadNotifications() {
            const panel = currentUser === 'admin' ? document.getElementById('notificationPanelAdmin') : document.getElementById('notificationPanel');
            panel.innerHTML = '<h3>Notifica√ß√µes</h3>';
            const notifs = data.notifications[currentUser] || [];
            if (notifs.length === 0) panel.innerHTML += '<p>Nenhuma</p>';
            notifs.forEach(n => panel.innerHTML += `<div>${n}</div>`);
        }

        // User
        function loadUserData() {
            document.getElementById('userCoins').textContent = data.users[currentUser].coins;
            const s = document.getElementById('rifaSelect');
            s.innerHTML = '<option>Selecione</option>';
            data.rifas.forEach(r => {
                if (new Date(r.date) > new Date() && !data.users[currentUser].rifasParticipadas.some(p => p.rifaId === r.id)) {
                    const o = document.createElement('option');
                    o.value = r.id; o.textContent = `${r.title} - R$${r.price}`;
                    s.appendChild(o);
                }
            });
            const div = document.getElementById('userRifas');
            div.innerHTML = '';
            data.users[currentUser].rifasParticipadas.forEach(p => {
                const r = data.rifas.find(x => x.id === p.rifaId);
                if (r) div.innerHTML += `<p>${r.title} - N¬∫ ${p.number}</p>`;
            });
        }

        function showRifaDetails() {
            const id = document.getElementById('rifaSelect').value;
            const d = document.getElementById('rifaDetails');
            d.innerHTML = '';
            d.classList.remove('active');
            if (!id) return;
            const r = data.rifas.find(x => x.id == id);
            const taken = r.participants ? r.participants.map(p => p.number) : [];
            const avail = Array.from({length: r.totalNumbers}, (_,i) => i+1).filter(n => !taken.includes(n));
            d.innerHTML = `<p>Dispon√≠veis: ${avail.length}</p><select id="num_${id}"><option>N√∫mero</option>${avail.map(n => `<option value="${n}">${n}</option>`).join('')}</select><button onclick="joinRifa(${id})">Entrar</button>`;
            d.classList.add('active');
        }

        function joinRifa(id) {
            loadData();
            const r = data.rifas.find(x => x.id == id);
            const num = +document.getElementById(`num_${id}`).value;
            if (isNaN(num) || r.participants.some(p => p.number === num)) return showMessage('N√∫mero inv√°lido!', 'error');
            if (data.users[currentUser].coins < r.price) return showMessage('Sem moedas!', 'error');
            data.users[currentUser].coins -= r.price;
            data.users[currentUser].rifasParticipadas.push({ rifaId: id, number: num });
            r.participants = r.participants || [];
            r.participants.push({ user: currentUser, number: num, chance: 1 });
            saveData();
            document.getElementById('userCoins').textContent = data.users[currentUser].coins;
            showMessage('Entrou!', 'success');
            loadUserData();
        }

        // Admin
        function loadAdmin() {
            ['userSelect', 'notifyUserSelect'].forEach(id => {
                const s = document.getElementById(id);
                s.innerHTML = '';
                Object.keys(data.users).filter(u => u !== 'admin').forEach(u => {
                    const o = document.createElement('option');
                    o.value = u; o.textContent = `${u} (${data.users[u].coins} moedas)`;
                    s.appendChild(o);
                });
            });
            const div = document.getElementById('adminRifas');
            div.innerHTML = '';
            data.rifas.forEach(r => {
                let status = new Date(r.date) < new Date() ? (r.winner ? `Ganhador: ${r.winner}` : 'Sorteando...') : 'Ativa';
                div.innerHTML += `<div class="rifa-item">${r.title} - ${status} <button onclick="deleteRifa(${r.id})">Excluir</button></div>`;
            });
        }

        function deleteRifa(id) {
            loadData();
            data.rifas = data.rifas.filter(r => r.id !== id);
            Object.keys(data.users).forEach(u => {
                data.users[u].rifasParticipadas = data.users[u].rifasParticipadas.filter(p => p.rifaId !== id);
            });
            saveData();
            loadAdmin();
        }

        document.getElementById('sendNotificationForm').onsubmit = (e) => {
            e.preventDefault();
            loadData();
            const u = document.getElementById('notifyUserSelect').value;
            const m = document.getElementById('notificationMessage').value;
            data.notifications[u] = data.notifications[u] || [];
            data.notifications[u].push(`Admin: ${m}`);
            saveData();
            showMessage('Enviado!', 'success');
            e.target.reset();
        };

        document.getElementById('giveCoinsForm').onsubmit = (e) => {
            e.preventDefault();
            loadData();
            const u = document.getElementById('userSelect').value;
            const a = +document.getElementById('coinAmount').value;
            data.users[u].coins += a;
            saveData();
            showMessage('Moedas dadas!', 'success');
            loadAdmin();
            e.target.reset();
        };

        document.getElementById('createRifaForm').onsubmit = (e) => {
            e.preventDefault();
            loadData();
            const title = document.getElementById('rifaTitle').value;
            const date = document.getElementById('rifaDate').value;
            const price = +document.getElementById('rifaPrice').value;
            const total = +document.getElementById('totalNumbers').value;
            const chances = {};
            const chancesText = document.getElementById('chancesText').value;
            if (chancesText) {
                chancesText.split(',').forEach(pair => {
                    const [user, weight, number] = pair.split(':');
                    chances[`${user.trim()}:${number.trim()}`] = parseInt(weight);
                });
            }
            const r = { id: Date.now(), title, date, price, totalNumbers: total, participants: [], winner: null, chances };
            data.rifas.push(r);
            saveData();
            showMessage('Rifa criada!', 'success');
            e.target.reset();
            document.getElementById('hiddenOpt').classList.remove('active');
            loadAdmin();
        };

        function toggleHiddenOpt() {
            document.getElementById('hiddenOpt').classList.toggle('active');
        }

        // Inicia
        loadData();
    </script>
</body>
</html>
